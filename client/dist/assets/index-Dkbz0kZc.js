import{Z as X,$ as Y,W as V,L as aa,b as ea,a8 as d,a1 as C,a9 as v,a2 as sa,aQ as q,aL as A,M as a,V as K,T as ta,a4 as na,a5 as ia,aK as la,U as w,F as M,y as m,a7 as $,aN as U,a0 as E}from"./index-Dk2PLuz_.js";import{S as F}from"./index-CFsBI2mW.js";const ca=async(_,g,h)=>{var r;try{const l=await X.post("/purchase/newPurchase",_);if(l.status!==201)throw new Error(l.statusText);const{data:y}=l.data;return y&&g({data:y,message:(r=l==null?void 0:l.data)==null?void 0:r.message}),!0}catch(l){return h(l==null?void 0:l.message),!1}},{Title:ha}=ta,{Step:ua}=F,pa=_=>{const g=aa(s=>{var i;return(i=s==null?void 0:s.auth)==null?void 0:i.user}),[h,r]=ea.useState(0),l={Sup_Name:"",Sup_Phno:"",purchases:[{P_Name:"",P_Qty:1,P_Cost:0,Mfg_Date:d(),Exp_Date:d(),Pur_Date:d()}]},y=[C().shape({Sup_Name:v().required("Name is required").matches(/^[A-Za-z ]+$/,"Name can contain only letters"),Sup_Phno:v().required("Phone is required").test("phone-number-check","should start with 03",s=>s==null?void 0:s.startsWith("03")).length(11,"Phone number should be 11 digits")}),C().shape({purchases:sa().of(C().shape({P_Name:v().required("Medicine Name is required"),P_Qty:A().positive().required("Quantity is required"),P_Cost:A().positive().required("Cost is required"),Mfg_Date:q().required("Mfg Date is required"),Exp_Date:q().required("Exp Date is required"),Pur_Date:q().required("Purchase Date is required")}))})],G=async(s,i)=>{_.setLoading(!0);const e={...s,purchaseMadeBy:g==null?void 0:g._id};await ca(e,H,J)&&i(),_.setLoading(!1)},H=s=>_.success(s==null?void 0:s.message),J=s=>_.error(s==null?void 0:s.message),S=[{title:"Supplier Details",content:({values:s,setFieldValue:i,errors:e,touched:t})=>a.jsxs(M,{gutter:16,children:[a.jsxs(m,{span:12,children:[a.jsx("label",{children:"Name"}),a.jsx($,{value:s.Sup_Name,onChange:c=>i("Sup_Name",c.target.value)}),(t==null?void 0:t.Sup_Name)&&(e==null?void 0:e.Sup_Name)&&a.jsx("div",{className:"error",children:e==null?void 0:e.Sup_Name})]}),a.jsxs(m,{span:12,children:[a.jsx("label",{children:"Phone"}),a.jsx($,{value:s.Sup_Phno,onChange:c=>i("Sup_Phno",c.target.value)}),(t==null?void 0:t.Sup_Phno)&&(e==null?void 0:e.Sup_Phno)&&a.jsx("div",{className:"error",children:e==null?void 0:e.Sup_Phno})]})]})},{title:"Purchase Details",content:({values:s,setFieldValue:i,errors:e,touched:t})=>a.jsx(a.Fragment,{children:s.purchases.map((c,n)=>{var N,j,p,x,P,f,D,b,Q,k,T,B,o,L,O,W,I,R,Z,z;return a.jsxs(K,{style:{marginBottom:16},children:[a.jsxs(M,{gutter:16,children:[a.jsxs(m,{span:8,children:[a.jsx("label",{children:"Medicine Name"}),a.jsx($,{value:c.P_Name,onChange:u=>i(`purchases[${n}].P_Name`,u.target.value)}),((j=(N=t==null?void 0:t.purchases)==null?void 0:N[n])==null?void 0:j.P_Name)&&((x=(p=e==null?void 0:e.purchases)==null?void 0:p[n])==null?void 0:x.P_Name)&&a.jsx("div",{className:"error",children:e.purchases[n].P_Name})]}),a.jsxs(m,{span:4,children:[a.jsx("label",{children:"Quantity"}),a.jsx(U,{min:1,style:{width:"100%"},value:c.P_Qty,onChange:u=>i(`purchases[${n}].P_Qty`,u)}),((f=(P=t==null?void 0:t.purchases)==null?void 0:P[n])==null?void 0:f.P_Qty)&&((b=(D=e==null?void 0:e.purchases)==null?void 0:D[n])==null?void 0:b.P_Qty)&&a.jsx("div",{className:"error",children:e.purchases[n].P_Qty})]}),a.jsxs(m,{span:4,children:[a.jsx("label",{children:"Cost"}),a.jsx(U,{min:0,style:{width:"100%"},value:c.P_Cost,onChange:u=>i(`purchases[${n}].P_Cost`,u)}),((k=(Q=t==null?void 0:t.purchases)==null?void 0:Q[n])==null?void 0:k.P_Cost)&&((B=(T=e==null?void 0:e.purchases)==null?void 0:T[n])==null?void 0:B.P_Cost)&&a.jsx("div",{className:"error",children:e.purchases[n].P_Cost})]}),a.jsxs(m,{span:8,children:[a.jsx("label",{children:"Purchase Date"}),a.jsx(E,{disabled:!0,style:{width:"100%"},value:d(c.Pur_Date),onChange:u=>i(`purchases[${n}].Pur_Date`,u)})]})]}),a.jsxs(M,{gutter:16,style:{marginTop:16},children:[a.jsxs(m,{span:8,children:[a.jsx("label",{children:"Mfg Date"}),a.jsx(E,{style:{width:"100%"},value:d(c.Mfg_Date),onChange:u=>i(`purchases[${n}].Mfg_Date`,u)}),((L=(o=t==null?void 0:t.purchases)==null?void 0:o[n])==null?void 0:L.Mfg_Date)&&((W=(O=e==null?void 0:e.purchases)==null?void 0:O[n])==null?void 0:W.Mfg_Date)&&a.jsx("div",{className:"error",children:e.purchases[n].Mfg_Date})]}),a.jsxs(m,{span:8,children:[a.jsx("label",{children:"Exp Date"}),a.jsx(E,{style:{width:"100%"},value:d(c.Exp_Date),onChange:u=>i(`purchases[${n}].Exp_Date`,u)}),((R=(I=t==null?void 0:t.purchases)==null?void 0:I[n])==null?void 0:R.Exp_Date)&&((z=(Z=e==null?void 0:e.purchases)==null?void 0:Z[n])==null?void 0:z.Exp_Date)&&a.jsx("div",{className:"error",children:e.purchases[n].Exp_Date})]})]})]},n)})})}];return a.jsxs(K,{children:[a.jsx(ha,{level:3,children:"Supplier & Purchase Entry"}),a.jsx(na,{initialValues:l,validationSchema:y[h],validateOnChange:!0,validateOnBlur:!0,onSubmit:async(s,{resetForm:i})=>{h<S.length-1?r(h+1):await G(s,i)},children:({values:s,setFieldValue:i,errors:e,touched:t,validateForm:c,handleSubmit:n,setTouched:N})=>a.jsxs(ia,{children:[a.jsx(F,{current:h,style:{marginBottom:32},children:S.map((j,p)=>a.jsx(ua,{title:j.title},p))}),a.jsx("div",{children:S[h].content({values:s,setFieldValue:i,errors:e,touched:t})}),a.jsx(la,{}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[h>0&&a.jsx(w,{onClick:()=>r(h-1),children:"Back"}),h<S.length-1?a.jsx(w,{type:"primary",onClick:()=>{c().then(j=>{if(Object.keys(j).length===0)r(h+1);else{const p={};Object.keys(j).forEach(x=>{if(x.includes("purchases")){const P=x.match(/purchases\[(\d+)\]\.(\w+)/);if(P){const[f,D,b]=P;p[`purchases.${D}.${b}`]=!0}}else p[x]=!0}),N(p)}})},children:"Next"}):a.jsx(w,{type:"primary",htmlType:"submit",loading:_.loading,children:"Submit"})]})]})})]})},ja=Y(V(pa));export{ja as default};
