import{Z as p,$ as P,a0 as I,T as R,a1 as S,a2 as T,a3 as j,b as y,M as n,a4 as w,a5 as k,U as C}from"./index-Dk2PLuz_.js";import{h as s}from"./moment-C5S46NFB.js";import{F as M}from"./Table-C14PA0_g.js";import"./index-By0mG6xB.js";import"./Pagination-Va9bAHz7.js";const b=async(o,t,i)=>{try{const c=await p.post("/sale/getSaleReports",o);if(c.status!==200)throw new Error(c.statusText);const{message:g,success:h,data:u}=c.data;h?t({data:u,message:g}):i(g)}catch{return!1}},{RangePicker:N}=I,{Title:E}=R,F=S().shape({dateRange:T().of(j().required()).length(2,"Please select a start and end date").required("Date range is required").test("max-6-months","Date range must not exceed 6 months",function(o){if(!o||o.length!==2)return!1;const[t,i]=o,c=6*30*24*60*60*1e3;return i-t<=c})});function B(o){const[t,i]=y.useState({loading:!1,currentPage:1,totalPages:0,totalDocsLength:0,data:[]}),c=async e=>{const[r,d]=e.dateRange,D={page:(t==null?void 0:t.currentPage)||1,startDate:s(new Date(r)).format("YYYY-MM-DD"),endDate:s(new Date(d)).format("YYYY-MM-DD")};await g(D)},g=async e=>{const r={page:(e==null?void 0:e.page)||1,startDate:e==null?void 0:e.startDate,endDate:e==null?void 0:e.endDate};i(d=>({...d,loading:!0})),await b(r,h,u)},h=e=>{console.log("options",e),o.success(e.message);const r=e.data;i({loading:!1,currentPage:e.page,totalPages:e==null?void 0:e.totalPages,totalDocsLength:e==null?void 0:e.totalDocsLength,data:r.docs})},u=e=>{i(r=>({...r,loading:!1})),o.error(e)};y.useEffect(()=>{(async()=>await g({page:1,startDate:s().format("YYYY-MM-DD"),endDate:s().format("YYYY-MM-DD")}))()},[]);const f=[{title:"Customer ID",dataIndex:"C_ID",key:"C_ID"},{title:"Customer Name",dataIndex:"C_Name",key:"C_NAME"},{title:"Total Amount",dataIndex:"Total_Price",key:"Total_Price"},{title:"Date",dataIndex:"created_at",key:"created_at",render:e=>s(e).format("YYYY-MM-DD")}],Y=e=>{var D;console.log("record",e);const r=(D=e.medicines)==null?void 0:D.map(a=>{var l,x,_,m;return{Med_Name:(l=a==null?void 0:a.Med_ID)==null?void 0:l.Med_Name,Med_Price:(x=a==null?void 0:a.Med_ID)==null?void 0:x.Med_Price,Tot_Price:(_=a==null?void 0:a.Med_ID)==null?void 0:_.Total_Price,Purchase_Date:(m=a==null?void 0:a.Med_ID)==null?void 0:m.Purchase_Date,Total_Sale_Qty:a==null?void 0:a.Sale_Qty}}),d=[{title:"Medicine Name",dataIndex:"Med_Name",key:"Med_Name"},{title:"Price",dataIndex:"Med_Price",key:"Med_Price"},{title:"Total Items Bought",dataIndex:"Total_Sale_Qty",key:"Total_Sale_Qty"},{title:"Purchase Date",dataIndex:"Purchase_Date",key:"Purchase_Date",render:a=>n.jsx("span",{children:s(a).format("YYYY-MM-DD")})}];return n.jsx(M,{columns:d,dataSource:r||[],pagination:!1,rowKey:a=>a._id})};return n.jsxs("div",{children:[n.jsx(E,{level:3,children:"Sales Reports"}),n.jsx("div",{style:{maxWidth:400,margin:"0 auto"},children:n.jsx(w,{initialValues:{dateRange:[s(),s()]},validationSchema:F,validateOnChange:!0,validateOnBlur:!0,onSubmit:c,children:({setFieldValue:e,values:r,errors:d,touched:D,isValid:a})=>n.jsx(k,{children:n.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx(N,{name:"dateRange",format:"YYYY-MM-DD",onChange:l=>{e("dateRange",l)},value:r.dateRange,disabledDate:l=>l&&l>s().endOf("day")}),d.dateRange&&D.dateRange&&n.jsx("div",{style:{color:"red"},children:d.dateRange}),n.jsx(C,{type:"primary",htmlType:"submit",disabled:!a,size:"small",children:"Get Report"})]})})})}),n.jsx("div",{children:n.jsx(M,{loading:t==null?void 0:t.loading,dataSource:t.data||[],columns:f,rowKey:"_id",expandable:{expandedRowRender:Y,rowExpandable:e=>e.medicines&&e.medicines.length>0},pagination:{current:t.currentPage||1,total:t.totalDocs||10,pageSize:10,onChange:e=>{g({page:e})}}})})]})}const z=P(B);export{z as default};
