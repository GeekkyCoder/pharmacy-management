import{b as i,L as E,h as V,a3 as L,aA as O,X as U,N as q,aB as H,O as e,H as I,y as z,$ as S,U as F,Z as P,ad as h,ae as y,aC as x,am as A,ac as v,aD as Y,a6 as D}from"./index-CZBkQvc6.js";import{A as B}from"./index-BQehCD_Z.js";var G={icon:function(r,o){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:o}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:o}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:r}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:r}}]}},name:"eye",theme:"twotone"},W=function(r,o){return i.createElement(E,V({},r,{ref:o,icon:G}))},j=i.forwardRef(W),X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},Z=function(r,o){return i.createElement(E,V({},r,{ref:o,icon:X}))},N=i.forwardRef(Z);const _=async d=>{try{const{userType:r,...o}=d,c=r==="employee"?"/employee/update-password":"/user/update-password";return await L.post(c,o)}catch(r){throw console.error("Update password error:",r),r}},J=async d=>{try{const{userType:r,...o}=d,c=r==="employee"?"/employee/change-password":"/user/change-password";return await L.post(c,o)}catch(r){throw console.error("Change password error:",r),r}},{Title:R,Text:C}=F,ae=()=>{const[d,r]=i.useState(!1),[o,c]=i.useState(""),[w,m]=i.useState(""),[b]=O(),u=U(),t=q(a=>a.auth.user),l=b.get("token"),M=b.get("type")||"user",n=!!l,f=!!t;i.useEffect(()=>{if(!l&&!t){u("/auth/login");return}n&&!l&&c("Invalid verification link. Please check your email for the correct link.")},[l,t,u,n]);const $=()=>{const a={newPassword:v().min(6,"Password must be at least 6 characters").required("New password is required"),confirmPassword:v().oneOf([Y("newPassword"),null],"Passwords must match").required("Please confirm your password")};return!n&&f&&(a.oldPassword=v().required("Current password is required")),D(a)},s=H({initialValues:(()=>{const a={newPassword:"",confirmPassword:""};return!n&&f&&(a.oldPassword=""),a})(),validationSchema:$(),onSubmit:async a=>{var k,T;r(!0),c(""),m("");try{let p;if(n){if(!l){c("Invalid verification token.");return}p=await _({token:l,newPassword:a.newPassword,confirmPassword:a.confirmPassword,userType:M}),m("Password updated successfully! Your account has been activated."),setTimeout(()=>{u("/auth/login")},2e3)}else console.log("Making password change request with:",{userRole:t==null?void 0:t.role,userType:(t==null?void 0:t.role)==="admin"?"admin":"employee",hasOldPassword:!!a.oldPassword}),p=await J({oldPassword:a.oldPassword,newPassword:a.newPassword,confirmPassword:a.confirmPassword,userType:(t==null?void 0:t.role)==="admin"?"admin":"employee"}),m("Password updated successfully!"),setTimeout(()=>{u("/")},2e3)}catch(p){c(((T=(k=p.response)==null?void 0:k.data)==null?void 0:T.message)||"Failed to update password. Please try again.")}finally{r(!1)}}});if(n&&!l)return e.jsx("div",{className:"update-password-container",children:e.jsx(I,{justify:"center",align:"middle",style:{minHeight:"100vh"},children:e.jsx(z,{xs:22,sm:16,md:12,lg:8,children:e.jsxs(S,{className:"update-password-card",children:[e.jsxs("div",{className:"update-password-header",children:[e.jsx(N,{className:"update-password-icon"}),e.jsx(R,{level:2,children:"Invalid Link"}),e.jsx(C,{type:"secondary",children:"This verification link is invalid or has expired. Please contact your administrator."})]}),e.jsx(P,{type:"primary",block:!0,onClick:()=>u("/auth/login"),style:{marginTop:20},children:"Go to Login"})]})})})});const g=n?{title:"Update Your Password",description:"Please set a new password to activate your account and complete the registration process.",footer:"Your account will be activated once you successfully update your password."}:{title:"Change Password",description:"Update your current password for enhanced security.",footer:"Choose a strong password that you haven't used before."};return e.jsx("div",{className:"update-password-container",children:e.jsx(I,{justify:"center",align:"middle",style:{minHeight:"100vh"},children:e.jsx(z,{xs:22,sm:16,md:12,lg:8,children:e.jsxs(S,{className:"update-password-card",children:[e.jsxs("div",{className:"update-password-header",children:[e.jsx(N,{className:"update-password-icon"}),e.jsx(R,{level:2,children:g.title}),e.jsx(C,{type:"secondary",children:g.description})]}),o&&e.jsx(B,{message:o,type:"error",showIcon:!0,closable:!0,onClose:()=>c(""),style:{marginBottom:20}}),w&&e.jsx(B,{message:w,description:n?"Redirecting to login page...":"Redirecting to dashboard...",type:"success",showIcon:!0,style:{marginBottom:20}}),e.jsxs(h,{layout:"vertical",onFinish:s.handleSubmit,children:[!n&&f&&e.jsx(h.Item,{label:"Current Password",validateStatus:s.touched.oldPassword&&s.errors.oldPassword?"error":"",help:s.touched.oldPassword&&s.errors.oldPassword?s.errors.oldPassword:null,children:e.jsx(y.Password,{name:"oldPassword",value:s.values.oldPassword,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"Enter current password",size:"large",iconRender:a=>a?e.jsx(j,{}):e.jsx(x,{})})}),e.jsx(h.Item,{label:"New Password",validateStatus:s.touched.newPassword&&s.errors.newPassword?"error":"",help:s.touched.newPassword&&s.errors.newPassword?s.errors.newPassword:null,children:e.jsx(y.Password,{name:"newPassword",value:s.values.newPassword,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"Enter new password",size:"large",iconRender:a=>a?e.jsx(j,{}):e.jsx(x,{})})}),e.jsx(h.Item,{label:"Confirm New Password",validateStatus:s.touched.confirmPassword&&s.errors.confirmPassword?"error":"",help:s.touched.confirmPassword&&s.errors.confirmPassword?s.errors.confirmPassword:null,children:e.jsx(y.Password,{name:"confirmPassword",value:s.values.confirmPassword,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"Confirm new password",size:"large",iconRender:a=>a?e.jsx(j,{}):e.jsx(x,{})})}),e.jsx(h.Item,{style:{marginBottom:0},children:e.jsxs(A,{direction:"vertical",style:{width:"100%"},children:[e.jsx(P,{type:"primary",htmlType:"submit",loading:d,block:!0,size:"large",disabled:!s.isValid||w,children:d?"Updating Password...":"Update Password"}),e.jsx(P,{type:"link",block:!0,onClick:()=>u(n?"/auth/login":"/"),disabled:d,children:n?"Back to Login":"Back to Dashboard"})]})})]}),e.jsx("div",{className:"update-password-footer",children:e.jsx(C,{type:"secondary",style:{fontSize:12},children:g.footer})})]})})})})};export{ae as default};
