import{Z as R,$ as w,W as E,b as l,M as e,V as S,F as u,y as n,T,a7 as C,a$ as b,a8 as p}from"./index-Dk2PLuz_.js";import{S as B,F}from"./Table-C14PA0_g.js";import{P as k}from"./Pagination-Va9bAHz7.js";import"./index-By0mG6xB.js";const I=async(c,j,y)=>{var o;try{const r=await R.get("/purchase/getSupplierAndPurchases",{params:c});if(r.status!==200)throw new Error((o=r.request)==null?void 0:o.message);const{data:i=[],limit:x=5,totalRecords:h,currentPage:g}=r==null?void 0:r.data;return i.length&&j({currentPage:g,limit:x,data:i,totalRecords:h}),!0}catch(r){return y(r==null?void 0:r.message),!1}},{Title:L}=T,N=c=>{const[j,y]=l.useState([]),[o,r]=l.useState(1),[i,x]=l.useState(5),[h,g]=l.useState({data:[],page:1,limit:5,totalRecords:0}),[m,f]=l.useState(""),P=async()=>{c.setLoading(!0);const a={Sup_Name:m||"",page:o,limit:i};try{await I(a,_,M)}catch(s){console.error("Error fetching data",s)}finally{c.setLoading(!1)}},_=async a=>{g({data:a.data,limit:a.limit,page:a.currentPage,totalRecords:a.totalRecords})},M=a=>{c.error(a)};l.useEffect(()=>{P()},[o,i,m]);const D=a=>{r(1),f(a.trim())},Y=[{title:"Supplier Name",dataIndex:"Sup_Name",key:"Sup_Name"},{title:"Phone",dataIndex:"Sup_Phno",key:"Sup_Phno"},{title:"Total Medicines",key:"totalMeds",render:(a,s)=>{var t;return((t=s.purchases)==null?void 0:t.length)||0}},{title:"Purchased By (Emp)",key:"purchaseMadeBy",render:(a,s)=>{var t,d;return((t=s.purchaseMadeBy)==null?void 0:t.E_Fname)||((d=s.purchaseMadeBy)==null?void 0:d.E_Lname)||"â€”"}},{title:"Date",key:"createdAt",render:(a,s)=>p(s.createdAt).format("DD MMM YYYY, hh:mm A")}];return e.jsxs(S,{children:[e.jsxs(u,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(n,{children:e.jsx(L,{level:4,children:"Supplier Purchase Records"})}),e.jsx(n,{children:e.jsx(B,{children:e.jsx(C.Search,{placeholder:"Search by supplier name",allowClear:!0,enterButton:e.jsx(b,{}),onSearch:D})})})]}),e.jsx(F,{loading:c.loading,columns:Y,dataSource:h.data,rowKey:"_id",pagination:!1,expandable:{expandedRowRender:a=>{var s;return e.jsx("div",{children:(s=a.purchases)==null?void 0:s.map((t,d)=>e.jsxs(S,{size:"small",type:"inner",title:`#${d+1} - ${t.P_Name}`,style:{marginBottom:12},children:[e.jsxs(u,{gutter:16,children:[e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Qty:"})," ",t.P_Qty]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Cost/unit:"})," Rs. ",t.P_Cost]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Mfg:"})," ",p(t.Mfg_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Exp:"})," ",p(t.Exp_Date).format("DD/MM/YYYY")]})]}),e.jsxs(u,{style:{marginTop:8},children:[e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Purchase Date:"})," ",p(t.Pur_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Total Price:"})," Rs."," ",(t.P_Qty*t.P_Cost).toFixed(2)]})]})]},d))})}}}),e.jsx(u,{justify:"end",style:{marginTop:24},children:e.jsx(k,{current:o,pageSize:i,total:h.totalRecords,onChange:(a,s)=>{r(a),x(s)},showSizeChanger:!0})})]})},W=w(E(N));export{W as default};
