import{a3 as R,W as w,V as C,U as T,b as i,O as e,$ as f,H as g,y as n,am as b,ae as B,av as E,a9 as N,ao as x,D as k}from"./index-CZBkQvc6.js";const I=async(c,m,y)=>{var o,d;try{const r=await R.get("/purchase/getSupplierAndPurchases",{params:c}),{data:l=[],limit:u=5,totalRecords:j,currentPage:p}=r==null?void 0:r.data;return l.length&&m({currentPage:p,limit:u,data:l,totalRecords:j}),!0}catch(r){const l=((d=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:d.message)||r.message||"Failed to fetch purchase data";return y(l),!1}},{Title:$}=T,A=c=>{const[m,y]=i.useState([]),[o,d]=i.useState(1),[r,l]=i.useState(5),[u,j]=i.useState({data:[],page:1,limit:5,totalRecords:0}),[p,S]=i.useState(""),P=async()=>{c.setLoading(!0);const a={Sup_Name:p||"",page:o,limit:r};try{await I(a,D,M)}catch(t){console.error("Error fetching data",t)}finally{c.setLoading(!1)}},D=async a=>{j({data:a.data,limit:a.limit,page:a.currentPage,totalRecords:a.totalRecords})},M=a=>{c.error(a)};i.useEffect(()=>{P()},[o,r,p]);const _=a=>{d(1),S(a.trim())},Y=[{title:"Supplier Name",dataIndex:"Sup_Name",key:"Sup_Name"},{title:"Phone",dataIndex:"Sup_Phno",key:"Sup_Phno"},{title:"Total Medicines",key:"totalMeds",render:(a,t)=>{var s;return((s=t.purchases)==null?void 0:s.length)||0}},{title:"Purchased By (Emp)",key:"purchaseMadeBy",render:(a,t)=>{var s,h;return`${(s=t.purchaseMadeBy)==null?void 0:s.userName} (${(h=t.purchaseMadeBy)==null?void 0:h.role})`}},{title:"Date",key:"createdAt",render:(a,t)=>x(t.createdAt).format("DD MMM YYYY, hh:mm A")}];return e.jsxs(f,{children:[e.jsxs(g,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(n,{children:e.jsx($,{level:4,children:"Supplier Purchase Records"})}),e.jsx(n,{children:e.jsx(b,{children:e.jsx(B.Search,{placeholder:"Search by supplier name",allowClear:!0,enterButton:e.jsx(E,{}),onSearch:_})})})]}),e.jsx(N,{loading:c.loading,columns:Y,dataSource:u.data,rowKey:"_id",pagination:!1,expandable:{expandedRowRender:a=>{var t;return e.jsx("div",{children:(t=a.purchases)==null?void 0:t.map((s,h)=>e.jsxs(f,{size:"small",type:"inner",title:`#${h+1} - ${s.P_Name}`,style:{marginBottom:12},children:[e.jsxs(g,{gutter:16,children:[e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Qty:"})," ",s.P_Qty]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Cost/unit:"})," Rs. ",s.P_Cost]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Mfg:"})," ",x(s.Mfg_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Exp:"})," ",x(s.Exp_Date).format("DD/MM/YYYY")]})]}),e.jsxs(g,{style:{marginTop:8},children:[e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Purchase Date:"})," ",x(s.Pur_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Total Price:"})," Rs."," ",(s.P_Qty*s.P_Cost).toFixed(2)]})]})]},h))})}}}),e.jsx(g,{justify:"end",style:{marginTop:24},children:e.jsx(k,{current:o,pageSize:r,total:u.totalRecords,onChange:(a,t)=>{d(a),l(t)},showSizeChanger:!0})})]})},L=w(C(A));export{L as default};
