import{a3 as R,W as w,V as E,U as B,b as i,O as e,$ as f,H as g,y as n,az as C,ae as T,aI as b,a9 as I,aB as x,D as k}from"./index-7GMsSKZT.js";const F=async(c,m,y)=>{var o,d;try{const r=await R.get("/purchase/getSupplierAndPurchases",{params:c}),{data:l=[],limit:u=5,totalRecords:j,currentPage:p}=r==null?void 0:r.data;return l.length&&m({currentPage:p,limit:u,data:l,totalRecords:j}),!0}catch(r){const l=((d=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:d.message)||r.message||"Failed to fetch purchase data";return y(l),!1}},{Title:L}=B,N=c=>{const[m,y]=i.useState([]),[o,d]=i.useState(1),[r,l]=i.useState(5),[u,j]=i.useState({data:[],page:1,limit:5,totalRecords:0}),[p,S]=i.useState(""),P=async()=>{c.setLoading(!0);const a={Sup_Name:p||"",page:o,limit:r};try{await F(a,_,D)}catch(s){console.error("Error fetching data",s)}finally{c.setLoading(!1)}},_=async a=>{j({data:a.data,limit:a.limit,page:a.currentPage,totalRecords:a.totalRecords})},D=a=>{c.error(a)};i.useEffect(()=>{P()},[o,r,p]);const M=a=>{d(1),S(a.trim())},Y=[{title:"Supplier Name",dataIndex:"Sup_Name",key:"Sup_Name"},{title:"Phone",dataIndex:"Sup_Phno",key:"Sup_Phno"},{title:"Total Medicines",key:"totalMeds",render:(a,s)=>{var t;return((t=s.purchases)==null?void 0:t.length)||0}},{title:"Purchased By (Emp)",key:"purchaseMadeBy",render:(a,s)=>{var t,h;return((t=s.purchaseMadeBy)==null?void 0:t.E_Fname)||((h=s.purchaseMadeBy)==null?void 0:h.E_Lname)||"â€”"}},{title:"Date",key:"createdAt",render:(a,s)=>x(s.createdAt).format("DD MMM YYYY, hh:mm A")}];return e.jsxs(f,{children:[e.jsxs(g,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(n,{children:e.jsx(L,{level:4,children:"Supplier Purchase Records"})}),e.jsx(n,{children:e.jsx(C,{children:e.jsx(T.Search,{placeholder:"Search by supplier name",allowClear:!0,enterButton:e.jsx(b,{}),onSearch:M})})})]}),e.jsx(I,{loading:c.loading,columns:Y,dataSource:u.data,rowKey:"_id",pagination:!1,expandable:{expandedRowRender:a=>{var s;return e.jsx("div",{children:(s=a.purchases)==null?void 0:s.map((t,h)=>e.jsxs(f,{size:"small",type:"inner",title:`#${h+1} - ${t.P_Name}`,style:{marginBottom:12},children:[e.jsxs(g,{gutter:16,children:[e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Qty:"})," ",t.P_Qty]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Cost/unit:"})," Rs. ",t.P_Cost]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Mfg:"})," ",x(t.Mfg_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:6,children:[e.jsx("strong",{children:"Exp:"})," ",x(t.Exp_Date).format("DD/MM/YYYY")]})]}),e.jsxs(g,{style:{marginTop:8},children:[e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Purchase Date:"})," ",x(t.Pur_Date).format("DD/MM/YYYY")]}),e.jsxs(n,{span:12,children:[e.jsx("strong",{children:"Total Price:"})," Rs."," ",(t.P_Qty*t.P_Cost).toFixed(2)]})]})]},h))})}}}),e.jsx(g,{justify:"end",style:{marginTop:24},children:e.jsx(k,{current:o,pageSize:r,total:u.totalRecords,onChange:(a,s)=>{d(a),l(s)},showSizeChanger:!0})})]})},A=w(E(N));export{A as default};
